var Xenon=function(){"use strict";var e="undefined"!=typeof globalThis&&globalThis||"undefined"!=typeof self&&self||void 0!==e&&e,t="URLSearchParams"in e,r="Symbol"in e&&"iterator"in Symbol,o="FileReader"in e&&"Blob"in e&&function(){try{return new Blob,!0}catch(e){return!1}}(),n="FormData"in e,s="ArrayBuffer"in e;if(s)var i=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],a=ArrayBuffer.isView||function(e){return e&&i.indexOf(Object.prototype.toString.call(e))>-1};function u(e){if("string"!=typeof e&&(e=String(e)),/[^a-z0-9\-#$%&'*+.^_`|~!]/i.test(e)||""===e)throw new TypeError('Invalid character in header field name: "'+e+'"');return e.toLowerCase()}function c(e){return"string"!=typeof e&&(e=String(e)),e}function l(e){var t={next:function(){var t=e.shift();return{done:void 0===t,value:t}}};return r&&(t[Symbol.iterator]=function(){return t}),t}function d(e){this.map={},e instanceof d?e.forEach((function(e,t){this.append(t,e)}),this):Array.isArray(e)?e.forEach((function(e){this.append(e[0],e[1])}),this):e&&Object.getOwnPropertyNames(e).forEach((function(t){this.append(t,e[t])}),this)}function h(e){if(e.bodyUsed)return Promise.reject(new TypeError("Already read"));e.bodyUsed=!0}function p(e){return new Promise((function(t,r){e.onload=function(){t(e.result)},e.onerror=function(){r(e.error)}}))}function m(e){var t=new FileReader,r=p(t);return t.readAsArrayBuffer(e),r}function f(e){if(e.slice)return e.slice(0);var t=new Uint8Array(e.byteLength);return t.set(new Uint8Array(e)),t.buffer}function y(){return this.bodyUsed=!1,this._initBody=function(e){var r;this.bodyUsed=this.bodyUsed,this._bodyInit=e,e?"string"==typeof e?this._bodyText=e:o&&Blob.prototype.isPrototypeOf(e)?this._bodyBlob=e:n&&FormData.prototype.isPrototypeOf(e)?this._bodyFormData=e:t&&URLSearchParams.prototype.isPrototypeOf(e)?this._bodyText=e.toString():s&&o&&((r=e)&&DataView.prototype.isPrototypeOf(r))?(this._bodyArrayBuffer=f(e.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):s&&(ArrayBuffer.prototype.isPrototypeOf(e)||a(e))?this._bodyArrayBuffer=f(e):this._bodyText=e=Object.prototype.toString.call(e):this._bodyText="",this.headers.get("content-type")||("string"==typeof e?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):t&&URLSearchParams.prototype.isPrototypeOf(e)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},o&&(this.blob=function(){var e=h(this);if(e)return e;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){if(this._bodyArrayBuffer){var e=h(this);return e||(ArrayBuffer.isView(this._bodyArrayBuffer)?Promise.resolve(this._bodyArrayBuffer.buffer.slice(this._bodyArrayBuffer.byteOffset,this._bodyArrayBuffer.byteOffset+this._bodyArrayBuffer.byteLength)):Promise.resolve(this._bodyArrayBuffer))}return this.blob().then(m)}),this.text=function(){var e,t,r,o=h(this);if(o)return o;if(this._bodyBlob)return e=this._bodyBlob,t=new FileReader,r=p(t),t.readAsText(e),r;if(this._bodyArrayBuffer)return Promise.resolve(function(e){for(var t=new Uint8Array(e),r=new Array(t.length),o=0;o<t.length;o++)r[o]=String.fromCharCode(t[o]);return r.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},n&&(this.formData=function(){return this.text().then(A)}),this.json=function(){return this.text().then(JSON.parse)},this}d.prototype.append=function(e,t){e=u(e),t=c(t);var r=this.map[e];this.map[e]=r?r+", "+t:t},d.prototype.delete=function(e){delete this.map[u(e)]},d.prototype.get=function(e){return e=u(e),this.has(e)?this.map[e]:null},d.prototype.has=function(e){return this.map.hasOwnProperty(u(e))},d.prototype.set=function(e,t){this.map[u(e)]=c(t)},d.prototype.forEach=function(e,t){for(var r in this.map)this.map.hasOwnProperty(r)&&e.call(t,this.map[r],r,this)},d.prototype.keys=function(){var e=[];return this.forEach((function(t,r){e.push(r)})),l(e)},d.prototype.values=function(){var e=[];return this.forEach((function(t){e.push(t)})),l(e)},d.prototype.entries=function(){var e=[];return this.forEach((function(t,r){e.push([r,t])})),l(e)},r&&(d.prototype[Symbol.iterator]=d.prototype.entries);var b=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function w(e,t){if(!(this instanceof w))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');var r,o,n=(t=t||{}).body;if(e instanceof w){if(e.bodyUsed)throw new TypeError("Already read");this.url=e.url,this.credentials=e.credentials,t.headers||(this.headers=new d(e.headers)),this.method=e.method,this.mode=e.mode,this.signal=e.signal,n||null==e._bodyInit||(n=e._bodyInit,e.bodyUsed=!0)}else this.url=String(e);if(this.credentials=t.credentials||this.credentials||"same-origin",!t.headers&&this.headers||(this.headers=new d(t.headers)),this.method=(r=t.method||this.method||"GET",o=r.toUpperCase(),b.indexOf(o)>-1?o:r),this.mode=t.mode||this.mode||null,this.signal=t.signal||this.signal,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&n)throw new TypeError("Body not allowed for GET or HEAD requests");if(this._initBody(n),!("GET"!==this.method&&"HEAD"!==this.method||"no-store"!==t.cache&&"no-cache"!==t.cache)){var s=/([?&])_=[^&]*/;if(s.test(this.url))this.url=this.url.replace(s,"$1_="+(new Date).getTime());else{this.url+=(/\?/.test(this.url)?"&":"?")+"_="+(new Date).getTime()}}}function A(e){var t=new FormData;return e.trim().split("&").forEach((function(e){if(e){var r=e.split("="),o=r.shift().replace(/\+/g," "),n=r.join("=").replace(/\+/g," ");t.append(decodeURIComponent(o),decodeURIComponent(n))}})),t}function g(e,t){if(!(this instanceof g))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');t||(t={}),this.type="default",this.status=void 0===t.status?200:t.status,this.ok=this.status>=200&&this.status<300,this.statusText=void 0===t.statusText?"":""+t.statusText,this.headers=new d(t.headers),this.url=t.url||"",this._initBody(e)}w.prototype.clone=function(){return new w(this,{body:this._bodyInit})},y.call(w.prototype),y.call(g.prototype),g.prototype.clone=function(){return new g(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new d(this.headers),url:this.url})},g.error=function(){var e=new g(null,{status:0,statusText:""});return e.type="error",e};var v=[301,302,303,307,308];g.redirect=function(e,t){if(-1===v.indexOf(t))throw new RangeError("Invalid status code");return new g(null,{status:t,headers:{location:e}})};var O=e.DOMException;try{new O}catch(e){(O=function(e,t){this.message=e,this.name=t;var r=Error(e);this.stack=r.stack}).prototype=Object.create(Error.prototype),O.prototype.constructor=O}function _(t,r){return new Promise((function(n,i){var a=new w(t,r);if(a.signal&&a.signal.aborted)return i(new O("Aborted","AbortError"));var u=new XMLHttpRequest;function l(){u.abort()}u.onload=function(){var e,t,r={status:u.status,statusText:u.statusText,headers:(e=u.getAllResponseHeaders()||"",t=new d,e.replace(/\r?\n[\t ]+/g," ").split("\r").map((function(e){return 0===e.indexOf("\n")?e.substr(1,e.length):e})).forEach((function(e){var r=e.split(":"),o=r.shift().trim();if(o){var n=r.join(":").trim();t.append(o,n)}})),t)};r.url="responseURL"in u?u.responseURL:r.headers.get("X-Request-URL");var o="response"in u?u.response:u.responseText;setTimeout((function(){n(new g(o,r))}),0)},u.onerror=function(){setTimeout((function(){i(new TypeError("Network request failed"))}),0)},u.ontimeout=function(){setTimeout((function(){i(new TypeError("Network request failed"))}),0)},u.onabort=function(){setTimeout((function(){i(new O("Aborted","AbortError"))}),0)},u.open(a.method,function(t){try{return""===t&&e.location.href?e.location.href:t}catch(e){return t}}(a.url),!0),"include"===a.credentials?u.withCredentials=!0:"omit"===a.credentials&&(u.withCredentials=!1),"responseType"in u&&(o?u.responseType="blob":s&&a.headers.get("Content-Type")&&-1!==a.headers.get("Content-Type").indexOf("application/octet-stream")&&(u.responseType="arraybuffer")),!r||"object"!=typeof r.headers||r.headers instanceof d?a.headers.forEach((function(e,t){u.setRequestHeader(t,e)})):Object.getOwnPropertyNames(r.headers).forEach((function(e){u.setRequestHeader(e,c(r.headers[e]))})),a.signal&&(a.signal.addEventListener("abort",l),u.onreadystatechange=function(){4===u.readyState&&a.signal.removeEventListener("abort",l)}),u.send(void 0===a._bodyInit?null:a._bodyInit)}))}async function j(e){if(e.status>=200&&e.status<400)return e;if(e.status>=400&&e.status<500){const t=await e.json(),r=new Error(t.error_message);return r.response=e,r.details=t,Promise.reject(r)}const t=new Error(e.statusText);return t.response=e,Promise.reject(t)}_.polyfill=!0,e.fetch||(e.fetch=_,e.Headers=d,e.Request=w,e.Response=g),self.fetch.bind(self);class S{constructor(e={}){const{name:t,method:r,headers:o,url:n,skipName:s,authenticated:i,apiUrl:a}=e;this.authenticated=i||!1,this.skipName=s||!1,this.name=t||"ApiBase",this.method=r||"POST",this.headers=o||{"content-type":"application/json"},this.apiUrl=a||null!=a?a:"https://app.xenonview.com",this.path_=n||""}params(e){return{}}path(e){return this.path_}fetch({data:e}={}){let t={};try{t=this.params(e)}catch(e){return Promise.reject(e)}let r={method:this.method,headers:this.headers};if(Object.keys(t).length||!this.skipName){let e={parameters:t};this.skipName||(e.name=this.name);const o=JSON.stringify(e);r.body=o}if(this.authenticated){const{token:t}=e;if(!t)return Promise.reject(new Error("No token and authenticated!"));r.accessToken=t}return function(e,{accessToken:t,headers:r,...o}={}){return o={credentials:"same-origin",headers:{accept:"application/json",...t?{authorization:`Bearer ${t}`}:{},...r},...o},fetch(e,o).then(j).then((e=>[204,304].includes(e.status)?{}:e.json())).catch((e=>{if(e instanceof TypeError){const e=new Error("Your internet connection appears to have gone down.");return e.noNet=!0,Promise.reject(e)}return Promise.reject(e)}))}(`${this.apiUrl}/${this.path(e)}`,r)}}class T extends S{constructor(e){super({name:"ApiJourney",url:"journey",apiUrl:e,authenticated:!0})}params(e){let t=function(e){const{journey:t}=e;return t?{journey:t}:{}}(e);const{id:r,timestamp:o}=e;return t.uuid=r,t.timestamp=o,t}}function P(e){return new T(e)}class C extends S{constructor(e){super({name:"ApiHeartbeat",url:"heartbeat",apiUrl:e,authenticated:!0})}params(e){let t=function(e){const{journey:t}=e;return t?{journey:t}:{}}(e);const{id:r,tags:o,platform:n,timestamp:s,watchdog:i}=e;return t.uuid=r,t.timestamp=s,t.tags=o,t.platform=n,i&&(t.watchdog=i),t}}function D(e){return new C(e)}class U extends S{constructor(e){super({name:"ApiDeanonymize",url:"deanonymize",apiUrl:e,authenticated:!0})}params(e){const{id:t,person:r,timestamp:o}=e;if(!r)throw new Error("No person data received.");let n={};return n.uuid=t,n.person=r,n.timestamp=o,n}}function E(e){return new U(e)}class x extends S{constructor(e){super({name:"ApiSample",url:"sample",apiUrl:e,authenticated:!0})}params(e){const{id:t}=e;let r={};return r.uuid=t,r}}function I(e){return new x(e)}const B={},R={setItem:(e,t)=>B[e]=t,getItem:e=>B[e],removeItem:e=>delete B[e]},k={},F={setItem:(e,t)=>k[e]=t,getItem:e=>k[e],removeItem:e=>delete k[e]};function N(){return null!=typeof window&&void 0!==window&&window&&window.localStorage?window.localStorage:null!=typeof browser&&void 0!==browser&&browser&&browser.localStorage?browser.localStorage:F}function J(){return null!=typeof window&&void 0!==window&&window&&window.sessionStorage?window.sessionStorage:null!=typeof browser&&void 0!==browser&&browser&&browser.sessionStorage?browser.sessionStorage:R}function L(e,t){N().setItem(e,JSON.stringify(t))}function H(e){const t=N().getItem(e);return t?JSON.parse(t):null}function q(e){N().removeItem(e)}function M(e,t){J().setItem(e,JSON.stringify(t))}function V(e){const t=J().getItem(e);return t?JSON.parse(t):null}function K(e){J().removeItem(e)}const z=new class{constructor(e=null,t="https://app.xenonview.com",r=P,o=E,n=D,s=I){this.JourneyApi=r,this.DeanonApi=o,this.HeartbeatApi=n,this.SampleApi=s,this.id(),this.journey()||this.storeJourney([]),this.restoreJourney=[],this.apiUrl=t,e&&this.init(e,t)}init(e,t="https://app.xenonview.com"){this.apiUrl=t,this.apiKey=e,this.sampleDecision()}ecomAbandonment(){L("heartbeat_type","ecom"),this.heartbeatState(0)}customAbandonment(e){L("heartbeat_type","custom"),L("heartbeat_outcome",e),this.heartbeatState(0)}cancelAbandonment(){L("heartbeat_type","custom"),L("heartbeat_outcome",{remove:!0}),this.heartbeatState(0)}platform(e,t,r,o){M("view-platform",{softwareVersion:e,deviceModel:t,operatingSystemName:r,operatingSystemVersion:o})}removePlatform(){K("view-platform")}variant(e){M("view-tags",e)}resetVariants(){K("view-tags")}leadAttributed(e,t){const r={superOutcome:"Lead Attributed",outcome:e,result:"success"};t&&(r.id=t),this.outcomeAdd(r)}leadCaptured(e){const t={superOutcome:"Lead Capture",outcome:e,result:"success"};this.outcomeAdd(t)}leadCaptureDeclined(e){const t={superOutcome:"Lead Capture",outcome:e,result:"fail"};this.outcomeAdd(t)}accountSignup(e){const t={superOutcome:"Account Signup",outcome:e,result:"success"};this.outcomeAdd(t)}accountSignupDeclined(e){const t={superOutcome:"Account Signup",outcome:e,result:"fail"};this.outcomeAdd(t)}applicationInstalled(){this.outcomeAdd({superOutcome:"Application Installation",outcome:"Installed",result:"success"})}applicationNotInstalled(){this.outcomeAdd({superOutcome:"Application Installation",outcome:"Not Installed",result:"fail"})}initialSubscription(e,t=null,r=null,o=null){const n={superOutcome:"Initial Subscription",outcome:"Subscribe - "+e,result:"success"};t&&(n.method=t),r&&(n.price=r),o&&(n.term=o),this.outcomeAdd(n)}subscriptionDeclined(e,t=null,r=null,o=null){const n={superOutcome:"Initial Subscription",outcome:"Decline - "+e,result:"fail"};t&&(n.method=t),r&&(n.price=r),o&&(n.term=o),this.outcomeAdd(n)}subscriptionRenewed(e,t=null,r=null,o=null){const n={superOutcome:"Subscription Renewal",outcome:"Renew - "+e,result:"success"};t&&(n.method=t),r&&(n.price=r),o&&(n.term=o),this.outcomeAdd(n)}subscriptionPaused(e,t=null,r=null,o=null){const n={superOutcome:"Subscription Renewal",outcome:"Paused - "+e,result:"fail"};t&&(n.method=t),r&&(n.price=r),o&&(n.term=o),this.outcomeAdd(n)}subscriptionCanceled(e,t=null,r=null,o=null){const n={superOutcome:"Subscription Renewal",outcome:"Cancel - "+e,result:"fail"};t&&(n.method=t),r&&(n.price=r),o&&(n.term=o),this.outcomeAdd(n)}subscriptionUpsold(e,t=null,r=null,o=null){const n={superOutcome:"Subscription Upsold",outcome:"Upsold - "+e,result:"success"};t&&(n.method=t),r&&(n.price=r),o&&(n.term=o),this.outcomeAdd(n)}subscriptionUpsellDeclined(e,t=null,r=null,o=null){const n={superOutcome:"Subscription Upsold",outcome:"Declined - "+e,result:"fail"};t&&(n.method=t),r&&(n.price=r),o&&(n.term=o),this.outcomeAdd(n)}subscriptionDownsell(e,t=null,r=null,o=null){const n={superOutcome:"Subscription Upsold",outcome:"Downsell - "+e,result:"fail"};t&&(n.method=t),r&&(n.price=r),o&&(n.term=o),this.outcomeAdd(n)}adClicked(e,t=null,r=null){const o={superOutcome:"Advertisement",outcome:"Ad Click - "+e,result:"success"};t&&(o.id=t),r&&(o.price=r),this.outcomeAdd(o)}adIgnored(e,t=null,r=null){const o={superOutcome:"Advertisement",outcome:"Ad Ignored - "+e,result:"fail"};t&&(o.id=t),r&&(o.price=r),this.outcomeAdd(o)}referral(e,t=null){const r={superOutcome:"Referral",outcome:"Referred - "+e,result:"success"};t&&(r.details=t),this.outcomeAdd(r)}referralDeclined(e,t=null){const r={superOutcome:"Referral",outcome:"Declined - "+e,result:"fail"};t&&(r.details=t),this.outcomeAdd(r)}productAddedToCart(e){const t={superOutcome:"Add Product To Cart",outcome:"Add - "+e,result:"success"};this.outcomeAdd(t),this.heartbeatState(1)}productNotAddedToCart(e){const t={superOutcome:"Add Product To Cart",outcome:"Ignore - "+e,result:"fail"};this.outcomeAdd(t)}upsold(e,t=null){const r={superOutcome:"Upsold Product",outcome:"Upsold - "+e,result:"success"};t&&(r.price=t),this.outcomeAdd(r)}upsellDismissed(e,t=null){const r={superOutcome:"Upsold Product",outcome:"Dismissed - "+e,result:"fail"};t&&(r.price=t),this.outcomeAdd(r)}checkOut(){this.outcomeAdd({superOutcome:"Customer Checkout",outcome:"Check Out",result:"success"}),this.heartbeatState(2)}checkoutCanceled(){this.outcomeAdd({superOutcome:"Customer Checkout",outcome:"Canceled",result:"fail"})}productRemoved(e){const t={superOutcome:"Customer Checkout",outcome:"Product Removed - "+e,result:"fail"};this.outcomeAdd(t)}purchase(e,t=null){const r={superOutcome:"Customer Purchase",outcome:"Purchase - "+e,result:"success"};t&&(r.price=t),this.outcomeAdd(r),this.heartbeatState(3)}purchaseCancel(e=null,t=null){const r={superOutcome:"Customer Purchase",outcome:"Canceled"+(e?" - "+e:""),result:"fail"};t&&(r.price=t),this.outcomeAdd(r)}promiseFulfilled(){this.outcomeAdd({superOutcome:"Promise Fulfillment",outcome:"Fulfilled",result:"success"})}promiseUnfulfilled(){this.outcomeAdd({superOutcome:"Promise Fulfillment",outcome:"Unfulfilled",result:"fail"})}productKept(e){const t={superOutcome:"Product Disposition",outcome:"Kept - "+e,result:"success"};this.outcomeAdd(t)}productReturned(e){const t={superOutcome:"Product Disposition",outcome:"Returned - "+e,result:"fail"};this.outcomeAdd(t)}featureAttempted(e,t=null){const r={category:"Feature",action:"Attempted",name:e};t&&(r.details=t),this.journeyAdd(r)}featureCompleted(e,t=null){const r={category:"Feature",action:"Completed",name:e};t&&(r.details=t),this.journeyAdd(r)}featureFailed(e,t=null){const r={category:"Feature",action:"Failed",name:e};t&&(r.details=t),this.journeyAdd(r)}contentViewed(e,t=null){const r={category:"Content",action:"Viewed",type:e};t&&(r.identifier=t),this.journeyAdd(r)}contentEdited(e,t=null,r=null){const o={category:"Content",action:"Edited",type:e};t&&(o.identifier=t),r&&(o.details=r),this.journeyAdd(o)}contentCreated(e,t=null){const r={category:"Content",action:"Created",type:e};t&&(r.identifier=t),this.journeyAdd(r)}contentDeleted(e,t=null){const r={category:"Content",action:"Deleted",type:e};t&&(r.identifier=t),this.journeyAdd(r)}contentArchived(e,t=null){const r={category:"Content",action:"Archived",type:e};t&&(r.identifier=t),this.journeyAdd(r)}contentRequested(e,t=null){const r={category:"Content",action:"Requested",type:e};t&&(r.identifier=t),this.journeyAdd(r)}contentSearched(e){const t={category:"Content",action:"Searched",type:e};this.journeyAdd(t)}pageLoadTime(e,t){const r={category:"Performance",action:"Page Load Time - "+e.toString(),identifier:t};this.journeyAdd(r)}milestone(e,t,r,o){const n={category:e,action:t,name:r,details:o};this.journeyAdd(n)}commit(e=!1){if(!this.sampleDecision())return new Promise.resolve(!0);let t={data:{id:this.id(),journey:this.journey(),token:this.apiKey,timestamp:(new Date).getTime()/1e3}};return this.reset(),this.JourneyApi(this.apiUrl).fetch(t).catch((t=>(this.restore(),e?new Promise.reject(t):new Promise.resolve(!0))))}heartbeatState(e=null){const t=H("heartbeat_stage");return e&&e>t&&L("heartbeat_stage",e),e||t||L("heartbeat_stage",0),Number(H("heartbeat_stage"))}heartbeatMessage(e){const t=this.heartbeatState(),r={ecom:{0:{expires_in_seconds:600,if_abandoned:{superOutcome:"Add Product To Cart",outcome:"Abandoned",result:"fail"}},1:{expires_in_seconds:600,if_abandoned:{superOutcome:"Customer Checkout",outcome:"Abandoned",result:"fail"}},2:{expires_in_seconds:600,if_abandoned:{superOutcome:"Customer Purchase",outcome:"Abandoned",result:"fail"}},3:{remove:!0}}};return Object.keys(r).includes(e)?r[e][t]:H("heartbeat_outcome")}heartbeat(e=!1){const t=V("view-platform"),r=V("view-tags");let o={data:{id:this.id(),journey:this.journey(),token:this.apiKey,platform:t||{},tags:r||[],timestamp:(new Date).getTime()/1e3}};const n=H("heartbeat_type");return n&&(o.data.watchdog=this.heartbeatMessage(n)),this.sampleDecision()?(this.reset(),this.HeartbeatApi(this.apiUrl).fetch(o).then((e=>(n&&Object.keys(o.data.watchdog).includes("remove")&&(q("heartbeat_stage"),q("heartbeat_type"),q("heartbeat_outcome")),new Promise.resolve(e)))).catch((t=>(this.restore(),e?new Promise.reject(t):new Promise.resolve(!0))))):new Promise.resolve(!0)}deanonymize(e){if(!this.sampleDecision())return new Promise.resolve(!0);let t={data:{id:this.id(),person:e,token:this.apiKey,timestamp:(new Date).getTime()/1e3}};return this.DeanonApi(this.apiUrl).fetch(t)}id(e){return e&&M("xenon-view",e),(e=V("xenon-view"))&&""!==e?e:this.newId()}newId(){return M("xenon-view",crypto.randomUUID()),V("xenon-view")}sampleDecision(e=null){if(null!==e&&M("xenon-will-sample",e),null===(e=V("xenon-will-sample"))||""===e){let t={data:{id:this.id(),token:this.apiKey}};this.SampleApi(this.apiUrl).fetch(t).then((t=>{e=this.sampleDecision(t.sample)})).catch((t=>{e=this.sampleDecision(!0)}))}return e=null!==e?Boolean(e):null}outcomeAdd(e){let t=V("view-platform");t&&(e.platform=t);let r=V("view-tags");r&&(e.tags=r),this.journeyAdd(e)}journeyAdd(e){let t=this.journey();if(e.timestamp=(new Date).getTime()/1e3,t&&t.length){let r=t[t.length-1];if(this.isDuplicate(r,e)){let e=r.hasOwnProperty("count")?r.count:1;r.count=e+1}else t.push(e)}else t=[e];this.storeJourney(t)}isDuplicate(e,t){const r=Object.keys(e),o=Object.keys(t);return!!((e,t)=>{for(const r of t)if(!e.has(r))return!1;return!0})(new Set(r),new Set(o))&&(!(!o.includes("category")||!r.includes("category"))&&(t.category===e.category&&(!(!o.includes("action")||!r.includes("action"))&&(t.action===e.action&&(this.duplicateFeature(e,t,r,o)||this.duplicateContent(e,t,r,o)||this.duplicateMilestone(e,t,r,o))))))}duplicateFeature(e,t,r,o){return"Feature"===t.category&&"Feature"===e.category&&t.name===e.name}duplicateContent(e,t,r,o){return"Content"===t.category&&"Content"===e.category&&(!o.includes("type")&&!r.includes("type")||t.type===e.type&&(!o.includes("identifier")&&!r.includes("identifier")||t.identifier===e.identifier&&(!o.includes("details")&&!r.includes("details")||t.details===e.details)))}duplicateMilestone(e,t,r,o){return"Feature"!==t.category&&"Feature"!==e.category&&("Content"!==t.category&&"Content"!==e.category&&(t.name===e.name&&t.details===e.details))}journey(){return H("view-journey")}storeJourney(e){L("view-journey",e)}reset(){this.restoreJourney=this.journey(),q("view-journey"),this.storeJourney([])}restore(){let e=this.journey(),t=this.restoreJourney;e&&e.length&&(t=t.concat(e)),this.storeJourney(t),this.restoreJourney=[]}hasClassInHierarchy(e,t,r){const o=(e,t,r,n)=>!(n>=r)&&(!!e.className.toString().includes(t)||!!e.parentElement&&o(e.parentElement,t,r,n+1));return o(e,t,r,0)}};return z}();
