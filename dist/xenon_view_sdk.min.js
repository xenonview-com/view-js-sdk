var Xenon=function(){"use strict";var e="undefined"!=typeof globalThis&&globalThis||"undefined"!=typeof self&&self||void 0!==e&&e,t="URLSearchParams"in e,o="Symbol"in e&&"iterator"in Symbol,r="FileReader"in e&&"Blob"in e&&function(){try{return new Blob,!0}catch(e){return!1}}(),n="FormData"in e,s="ArrayBuffer"in e;if(s)var i=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],a=ArrayBuffer.isView||function(e){return e&&i.indexOf(Object.prototype.toString.call(e))>-1};function u(e){if("string"!=typeof e&&(e=String(e)),/[^a-z0-9\-#$%&'*+.^_`|~!]/i.test(e)||""===e)throw new TypeError('Invalid character in header field name: "'+e+'"');return e.toLowerCase()}function c(e){return"string"!=typeof e&&(e=String(e)),e}function d(e){var t={next:function(){var t=e.shift();return{done:void 0===t,value:t}}};return o&&(t[Symbol.iterator]=function(){return t}),t}function l(e){this.map={},e instanceof l?e.forEach((function(e,t){this.append(t,e)}),this):Array.isArray(e)?e.forEach((function(e){this.append(e[0],e[1])}),this):e&&Object.getOwnPropertyNames(e).forEach((function(t){this.append(t,e[t])}),this)}function h(e){if(e.bodyUsed)return Promise.reject(new TypeError("Already read"));e.bodyUsed=!0}function p(e){return new Promise((function(t,o){e.onload=function(){t(e.result)},e.onerror=function(){o(e.error)}}))}function m(e){var t=new FileReader,o=p(t);return t.readAsArrayBuffer(e),o}function f(e){if(e.slice)return e.slice(0);var t=new Uint8Array(e.byteLength);return t.set(new Uint8Array(e)),t.buffer}function y(){return this.bodyUsed=!1,this._initBody=function(e){var o;this.bodyUsed=this.bodyUsed,this._bodyInit=e,e?"string"==typeof e?this._bodyText=e:r&&Blob.prototype.isPrototypeOf(e)?this._bodyBlob=e:n&&FormData.prototype.isPrototypeOf(e)?this._bodyFormData=e:t&&URLSearchParams.prototype.isPrototypeOf(e)?this._bodyText=e.toString():s&&r&&((o=e)&&DataView.prototype.isPrototypeOf(o))?(this._bodyArrayBuffer=f(e.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):s&&(ArrayBuffer.prototype.isPrototypeOf(e)||a(e))?this._bodyArrayBuffer=f(e):this._bodyText=e=Object.prototype.toString.call(e):this._bodyText="",this.headers.get("content-type")||("string"==typeof e?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):t&&URLSearchParams.prototype.isPrototypeOf(e)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},r&&(this.blob=function(){var e=h(this);if(e)return e;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){if(this._bodyArrayBuffer){var e=h(this);return e||(ArrayBuffer.isView(this._bodyArrayBuffer)?Promise.resolve(this._bodyArrayBuffer.buffer.slice(this._bodyArrayBuffer.byteOffset,this._bodyArrayBuffer.byteOffset+this._bodyArrayBuffer.byteLength)):Promise.resolve(this._bodyArrayBuffer))}return this.blob().then(m)}),this.text=function(){var e,t,o,r=h(this);if(r)return r;if(this._bodyBlob)return e=this._bodyBlob,t=new FileReader,o=p(t),t.readAsText(e),o;if(this._bodyArrayBuffer)return Promise.resolve(function(e){for(var t=new Uint8Array(e),o=new Array(t.length),r=0;r<t.length;r++)o[r]=String.fromCharCode(t[r]);return o.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},n&&(this.formData=function(){return this.text().then(w)}),this.json=function(){return this.text().then(JSON.parse)},this}l.prototype.append=function(e,t){e=u(e),t=c(t);var o=this.map[e];this.map[e]=o?o+", "+t:t},l.prototype.delete=function(e){delete this.map[u(e)]},l.prototype.get=function(e){return e=u(e),this.has(e)?this.map[e]:null},l.prototype.has=function(e){return this.map.hasOwnProperty(u(e))},l.prototype.set=function(e,t){this.map[u(e)]=c(t)},l.prototype.forEach=function(e,t){for(var o in this.map)this.map.hasOwnProperty(o)&&e.call(t,this.map[o],o,this)},l.prototype.keys=function(){var e=[];return this.forEach((function(t,o){e.push(o)})),d(e)},l.prototype.values=function(){var e=[];return this.forEach((function(t){e.push(t)})),d(e)},l.prototype.entries=function(){var e=[];return this.forEach((function(t,o){e.push([o,t])})),d(e)},o&&(l.prototype[Symbol.iterator]=l.prototype.entries);var b=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function A(e,t){if(!(this instanceof A))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');var o,r,n=(t=t||{}).body;if(e instanceof A){if(e.bodyUsed)throw new TypeError("Already read");this.url=e.url,this.credentials=e.credentials,t.headers||(this.headers=new l(e.headers)),this.method=e.method,this.mode=e.mode,this.signal=e.signal,n||null==e._bodyInit||(n=e._bodyInit,e.bodyUsed=!0)}else this.url=String(e);if(this.credentials=t.credentials||this.credentials||"same-origin",!t.headers&&this.headers||(this.headers=new l(t.headers)),this.method=(o=t.method||this.method||"GET",r=o.toUpperCase(),b.indexOf(r)>-1?r:o),this.mode=t.mode||this.mode||null,this.signal=t.signal||this.signal,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&n)throw new TypeError("Body not allowed for GET or HEAD requests");if(this._initBody(n),!("GET"!==this.method&&"HEAD"!==this.method||"no-store"!==t.cache&&"no-cache"!==t.cache)){var s=/([?&])_=[^&]*/;if(s.test(this.url))this.url=this.url.replace(s,"$1_="+(new Date).getTime());else{this.url+=(/\?/.test(this.url)?"&":"?")+"_="+(new Date).getTime()}}}function w(e){var t=new FormData;return e.trim().split("&").forEach((function(e){if(e){var o=e.split("="),r=o.shift().replace(/\+/g," "),n=o.join("=").replace(/\+/g," ");t.append(decodeURIComponent(r),decodeURIComponent(n))}})),t}function g(e,t){if(!(this instanceof g))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');t||(t={}),this.type="default",this.status=void 0===t.status?200:t.status,this.ok=this.status>=200&&this.status<300,this.statusText=void 0===t.statusText?"":""+t.statusText,this.headers=new l(t.headers),this.url=t.url||"",this._initBody(e)}A.prototype.clone=function(){return new A(this,{body:this._bodyInit})},y.call(A.prototype),y.call(g.prototype),g.prototype.clone=function(){return new g(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new l(this.headers),url:this.url})},g.error=function(){var e=new g(null,{status:0,statusText:""});return e.type="error",e};var v=[301,302,303,307,308];g.redirect=function(e,t){if(-1===v.indexOf(t))throw new RangeError("Invalid status code");return new g(null,{status:t,headers:{location:e}})};var O=e.DOMException;try{new O}catch(e){(O=function(e,t){this.message=e,this.name=t;var o=Error(e);this.stack=o.stack}).prototype=Object.create(Error.prototype),O.prototype.constructor=O}function j(t,o){return new Promise((function(n,i){var a=new A(t,o);if(a.signal&&a.signal.aborted)return i(new O("Aborted","AbortError"));var u=new XMLHttpRequest;function d(){u.abort()}u.onload=function(){var e,t,o={status:u.status,statusText:u.statusText,headers:(e=u.getAllResponseHeaders()||"",t=new l,e.replace(/\r?\n[\t ]+/g," ").split("\r").map((function(e){return 0===e.indexOf("\n")?e.substr(1,e.length):e})).forEach((function(e){var o=e.split(":"),r=o.shift().trim();if(r){var n=o.join(":").trim();t.append(r,n)}})),t)};o.url="responseURL"in u?u.responseURL:o.headers.get("X-Request-URL");var r="response"in u?u.response:u.responseText;setTimeout((function(){n(new g(r,o))}),0)},u.onerror=function(){setTimeout((function(){i(new TypeError("Network request failed"))}),0)},u.ontimeout=function(){setTimeout((function(){i(new TypeError("Network request failed"))}),0)},u.onabort=function(){setTimeout((function(){i(new O("Aborted","AbortError"))}),0)},u.open(a.method,function(t){try{return""===t&&e.location.href?e.location.href:t}catch(e){return t}}(a.url),!0),"include"===a.credentials?u.withCredentials=!0:"omit"===a.credentials&&(u.withCredentials=!1),"responseType"in u&&(r?u.responseType="blob":s&&a.headers.get("Content-Type")&&-1!==a.headers.get("Content-Type").indexOf("application/octet-stream")&&(u.responseType="arraybuffer")),!o||"object"!=typeof o.headers||o.headers instanceof l?a.headers.forEach((function(e,t){u.setRequestHeader(t,e)})):Object.getOwnPropertyNames(o.headers).forEach((function(e){u.setRequestHeader(e,c(o.headers[e]))})),a.signal&&(a.signal.addEventListener("abort",d),u.onreadystatechange=function(){4===u.readyState&&a.signal.removeEventListener("abort",d)}),u.send(void 0===a._bodyInit?null:a._bodyInit)}))}async function T(e){if(e.status>=200&&e.status<400)return e;if(e.status>=400&&e.status<500){const t=await e.json(),o=new Error(t.error_message);return o.response=e,o.details=t,Promise.reject(o)}const t=new Error(e.statusText);return t.response=e,Promise.reject(t)}j.polyfill=!0,e.fetch||(e.fetch=j,e.Headers=l,e.Request=A,e.Response=g),self.fetch.bind(self);class C{constructor(e={}){const{name:t,method:o,headers:r,url:n,skipName:s,authenticated:i,apiUrl:a}=e;this.authenticated=i||!1,this.skipName=s||!1,this.name=t||"ApiBase",this.method=o||"POST",this.headers=r||{"content-type":"application/json"},this.apiUrl=a||null!=a?a:"https://app.xenonview.com",this.path_=n||""}params(e){return{}}path(e){return this.path_}fetch({data:e}={}){let t={};try{t=this.params(e)}catch(e){return Promise.reject(e)}let o={method:this.method,headers:this.headers};if(Object.keys(t).length||!this.skipName){let e={parameters:t};this.skipName||(e.name=this.name);const r=JSON.stringify(e);o.body=r}if(this.authenticated){const{token:t}=e;if(!t)return Promise.reject(new Error("No token and authenticated!"));o.accessToken=t}return function(e,{accessToken:t,headers:o,...r}={}){return r={credentials:"same-origin",headers:{accept:"application/json",...t?{authorization:`Bearer ${t}`}:{},...o},...r},fetch(e,r).then(T).then((e=>[204,304].includes(e.status)?{}:e.json())).catch((e=>{if(e instanceof TypeError){const e=new Error("Your internet connection appears to have gone down.");return e.noNet=!0,Promise.reject(e)}return Promise.reject(e)}))}(`${this.apiUrl}/${this.path(e)}`,o)}}class P extends C{constructor(e){super({name:"ApiJourney",url:"journey",apiUrl:e,authenticated:!0})}params(e){let t=function(e){const{journey:t}=e;return t?{journey:t}:{}}(e);const{id:o,timestamp:r}=e;return t.uuid=o,t.timestamp=r,t}}function U(e){return new P(e)}class S extends C{constructor(e){super({name:"ApiHeartbeat",url:"heartbeat",apiUrl:e,authenticated:!0})}params(e){let t=function(e){const{journey:t}=e;return t?{journey:t}:{}}(e);const{id:o,tags:r,platform:n,timestamp:s}=e;return t.uuid=o,t.timestamp=s,t.tags=r,t.platform=n,t}}function E(e){return new S(e)}class _ extends C{constructor(e){super({name:"ApiDeanonymize",url:"deanonymize",apiUrl:e,authenticated:!0})}params(e){const{id:t,person:o,timestamp:r}=e;if(!o)throw new Error("No person data received.");let n={};return n.uuid=t,n.person=o,n.timestamp=r,n}}function D(e){return new _(e)}function x(e,t){sessionStorage.setItem(e,JSON.stringify(t))}function B(e){return JSON.parse(sessionStorage.getItem(e))}function I(e){sessionStorage.removeItem(e)}const R=new class{constructor(e,t="https://app.xenonview.com",o=U,r=D,n=E){let s=this.id();s&&""!==s||x("xenon-view",crypto.randomUUID()),this.journey()||this.storeJourney([]),this.restoreJourney=[],this.JourneyApi=o,this.DeanonApi=r,this.HeartbeatApi=n,this.init(e,t)}init(e,t="https://app.xenonview.com"){this.apiUrl=t,this.apiKey=e}platform(e,t,o,r){x("view-platform",{softwareVersion:e,deviceModel:t,operatingSystemName:o,operatingSystemVersion:r})}removePlatform(){I("view-platform")}variant(e){x("view-tags",e)}resetVariants(){I("view-tags")}leadCaptured(e){const t={superOutcome:"Lead Capture",outcome:e,result:"success"};this.outcomeAdd(t)}leadCaptureDeclined(e){const t={superOutcome:"Lead Capture",outcome:e,result:"fail"};this.outcomeAdd(t)}accountSignup(e){const t={superOutcome:"Account Signup",outcome:e,result:"success"};this.outcomeAdd(t)}accountSignupDeclined(e){const t={superOutcome:"Account Signup",outcome:e,result:"fail"};this.outcomeAdd(t)}applicationInstalled(){this.outcomeAdd({superOutcome:"Application Installation",outcome:"Installed",result:"success"})}applicationNotInstalled(){this.outcomeAdd({superOutcome:"Application Installation",outcome:"Not Installed",result:"fail"})}initialSubscription(e,t=null,o=null){const r={superOutcome:"Initial Subscription",outcome:"Subscribe - "+e,result:"success"};t&&(r.method=t),o&&(r.value=o),this.outcomeAdd(r)}subscriptionDeclined(e,t=null,o=null){const r={superOutcome:"Initial Subscription",outcome:"Decline - "+e,result:"fail"};t&&(r.method=t),o&&(r.value=o),this.outcomeAdd(r)}subscriptionRenewed(e,t=null,o=null){const r={superOutcome:"Subscription Renewal",outcome:"Renew - "+e,result:"success"};t&&(r.method=t),o&&(r.value=o),this.outcomeAdd(r)}subscriptionPaused(e,t=null,o=null){const r={superOutcome:"Subscription Renewal",outcome:"Paused - "+e,result:"fail"};t&&(r.method=t),o&&(r.value=o),this.outcomeAdd(r)}subscriptionCanceled(e,t=null,o=null){const r={superOutcome:"Subscription Renewal",outcome:"Cancel - "+e,result:"fail"};t&&(r.method=t),o&&(r.value=o),this.outcomeAdd(r)}subscriptionUpsold(e,t=null,o=null){const r={superOutcome:"Subscription Upsold",outcome:"Upsold - "+e,result:"success"};t&&(r.method=t),o&&(r.value=o),this.outcomeAdd(r)}subscriptionUpsellDeclined(e,t=null,o=null){const r={superOutcome:"Subscription Upsold",outcome:"Declined - "+e,result:"fail"};t&&(r.method=t),o&&(r.value=o),this.outcomeAdd(r)}subscriptionDownsell(e,t=null,o=null){const r={superOutcome:"Subscription Upsold",outcome:"Downsell - "+e,result:"fail"};t&&(r.method=t),o&&(r.value=o),this.outcomeAdd(r)}adClicked(e,t=null,o=null){const r={superOutcome:"Advertisement",outcome:"Ad Click - "+e,result:"success"};t&&(r.id=t),o&&(r.value=o),this.outcomeAdd(r)}adIgnored(e,t=null,o=null){const r={superOutcome:"Advertisement",outcome:"Ad Ignored - "+e,result:"fail"};t&&(r.id=t),o&&(r.value=o),this.outcomeAdd(r)}referral(e,t=null){const o={superOutcome:"Referral",outcome:"Referred - "+e,result:"success"};t&&(o.details=t),this.outcomeAdd(o)}referralDeclined(e,t=null){const o={superOutcome:"Referral",outcome:"Declined - "+e,result:"fail"};t&&(o.details=t),this.outcomeAdd(o)}productAddedToCart(e){const t={superOutcome:"Add Product To Cart",outcome:"Add - "+e,result:"success"};this.outcomeAdd(t)}productNotAddedToCart(e){const t={superOutcome:"Add Product To Cart",outcome:"Ignore - "+e,result:"fail"};this.outcomeAdd(t)}upsold(e,t=null){const o={superOutcome:"Upsold Product",outcome:"Upsold - "+e,result:"success"};t&&(o.value=t),this.outcomeAdd(o)}upsellDismissed(e,t=null){const o={superOutcome:"Upsold Product",outcome:"Dismissed - "+e,result:"fail"};t&&(o.value=t),this.outcomeAdd(o)}checkedOut(){this.outcomeAdd({superOutcome:"Customer Checkout",outcome:"Checked Out",result:"success"})}checkoutCanceled(){this.outcomeAdd({superOutcome:"Customer Checkout",outcome:"Canceled",result:"fail"})}productRemoved(e){const t={superOutcome:"Customer Checkout",outcome:"Product Removed - "+e,result:"fail"};this.outcomeAdd(t)}purchased(e,t=null){const o={superOutcome:"Customer Purchase",outcome:"Purchase - "+e,result:"success"};t&&(o.value=t),this.outcomeAdd(o)}purchaseCanceled(e=null,t=null){const o={superOutcome:"Customer Purchase",outcome:"Canceled"+(e?" - "+e:""),result:"fail"};t&&(o.value=t),this.outcomeAdd(o)}promiseFulfilled(){this.outcomeAdd({superOutcome:"Promise Fulfillment",outcome:"Fulfilled",result:"success"})}promiseUnfulfilled(){this.outcomeAdd({superOutcome:"Promise Fulfillment",outcome:"Unfulfilled",result:"fail"})}productKept(e){const t={superOutcome:"Product Disposition",outcome:"Kept - "+e,result:"success"};this.outcomeAdd(t)}productReturned(e){const t={superOutcome:"Product Disposition",outcome:"Returned - "+e,result:"fail"};this.outcomeAdd(t)}featureAttempted(e,t=null){const o={category:"Feature",action:"Attempted",name:e};t&&(o.details=t),this.journeyAdd(o)}featureCompleted(e,t=null){const o={category:"Feature",action:"Completed",name:e};t&&(o.details=t),this.journeyAdd(o)}featureFailed(e,t=null){const o={category:"Feature",action:"Failed",name:e};t&&(o.details=t),this.journeyAdd(o)}contentViewed(e,t=null){const o={category:"Content",action:"Viewed",type:e};t&&(o.identifier=t),this.journeyAdd(o)}contentEdited(e,t=null,o=null){const r={category:"Content",action:"Edited",type:e};t&&(r.identifier=t),o&&(r.details=o),this.journeyAdd(r)}contentCreated(e,t=null){const o={category:"Content",action:"Created",type:e};t&&(o.identifier=t),this.journeyAdd(o)}contentDeleted(e,t=null){const o={category:"Content",action:"Deleted",type:e};t&&(o.identifier=t),this.journeyAdd(o)}contentArchived(e,t=null){const o={category:"Content",action:"Archived",type:e};t&&(o.identifier=t),this.journeyAdd(o)}contentRequested(e,t=null){const o={category:"Content",action:"Requested",type:e};t&&(o.identifier=t),this.journeyAdd(o)}contentSearched(e){const t={category:"Content",action:"Searched",type:e};this.journeyAdd(t)}milestone(e,t,o,r){const n={category:e,action:t,name:o,details:r};this.journeyAdd(n)}commit(){let e={data:{id:this.id(),journey:this.journey(),token:this.apiKey,timestamp:(new Date).getTime()/1e3}};return this.reset(),this.JourneyApi(this.apiUrl).fetch(e).catch((e=>{this.restore()}))}heartbeat(){const e=B("view-platform"),t=B("view-tags");let o={data:{id:this.id(),journey:this.journey(),token:this.apiKey,platform:e||{},tags:t||[],timestamp:(new Date).getTime()/1e3}};return this.reset(),this.HeartbeatApi(this.apiUrl).fetch(o).catch((e=>{this.restore()}))}deanonymize(e){let t={data:{id:this.id(),person:e,token:this.apiKey,timestamp:(new Date).getTime()/1e3}};return this.DeanonApi(this.apiUrl).fetch(t)}id(e){return e&&x("xenon-view",e),B("xenon-view")}newId(){x("xenon-view",crypto.randomUUID())}outcomeAdd(e){let t=B("view-platform");t&&(e.platform=t);let o=B("view-tags");o&&(e.tags=o),this.journeyAdd(e)}journeyAdd(e){let t=this.journey();if(e.timestamp=(new Date).getTime()/1e3,t&&t.length){let o=t[t.length-1];if(this.isDuplicate(o,e)){let e=o.hasOwnProperty("count")?o.count:1;o.count=e+1}else t.push(e)}else t=[e];this.storeJourney(t)}isDuplicate(e,t){const o=Object.keys(e),r=Object.keys(t);return!!((e,t)=>{for(const o of t)if(!e.has(o))return!1;return!0})(new Set(o),new Set(r))&&(!(!r.includes("category")||!o.includes("category"))&&(t.category===e.category&&(!(!r.includes("action")||!o.includes("action"))&&(t.action===e.action&&(this.duplicateFeature(e,t,o,r)||this.duplicateContent(e,t,o,r)||this.duplicateMilestone(e,t,o,r))))))}duplicateFeature(e,t,o,r){return"Feature"===t.category&&"Feature"===e.category&&t.name===e.name}duplicateContent(e,t,o,r){return"Content"===t.category&&"Content"===e.category&&(!r.includes("type")&&!o.includes("type")||t.type===e.type&&(!r.includes("identifier")&&!o.includes("identifier")||t.identifier===e.identifier&&(!r.includes("details")&&!o.includes("details")||t.details===e.details)))}duplicateMilestone(e,t,o,r){return"Feature"!==t.category&&"Feature"!==e.category&&("Content"!==t.category&&"Content"!==e.category&&(t.name===e.name&&t.details===e.details))}journey(){return e="view-journey",JSON.parse(localStorage.getItem(e));var e}storeJourney(e){var t,o;t="view-journey",o=e,localStorage.setItem(t,JSON.stringify(o))}reset(){var e;this.restoreJourney=this.journey(),e="view-journey",localStorage.removeItem(e),this.storeJourney([])}restore(){let e=this.journey(),t=this.restoreJourney;e&&e.length&&(t=t.concat(e)),this.storeJourney(t),this.restoreJourney=[]}};return R}();
