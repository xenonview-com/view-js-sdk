var Xenon=function(){"use strict";var e="undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},t="undefined"!=typeof globalThis&&globalThis||"undefined"!=typeof self&&self||void 0!==e&&e||{},r="URLSearchParams"in t,o="Symbol"in t&&"iterator"in Symbol,n="FileReader"in t&&"Blob"in t&&function(){try{return new Blob,!0}catch(e){return!1}}(),s="FormData"in t,i="ArrayBuffer"in t;if(i)var a=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],u=ArrayBuffer.isView||function(e){return e&&a.indexOf(Object.prototype.toString.call(e))>-1};function c(e){if("string"!=typeof e&&(e=String(e)),/[^a-z0-9\-#$%&'*+.^_`|~!]/i.test(e)||""===e)throw new TypeError('Invalid character in header field name: "'+e+'"');return e.toLowerCase()}function l(e){return"string"!=typeof e&&(e=String(e)),e}function d(e){var t={next:function(){var t=e.shift();return{done:void 0===t,value:t}}};return o&&(t[Symbol.iterator]=function(){return t}),t}function h(e){this.map={},e instanceof h?e.forEach((function(e,t){this.append(t,e)}),this):Array.isArray(e)?e.forEach((function(e){if(2!=e.length)throw new TypeError("Headers constructor: expected name/value pair to be length 2, found"+e.length);this.append(e[0],e[1])}),this):e&&Object.getOwnPropertyNames(e).forEach((function(t){this.append(t,e[t])}),this)}function p(e){if(!e._noBody)return e.bodyUsed?Promise.reject(new TypeError("Already read")):void(e.bodyUsed=!0)}function m(e){return new Promise((function(t,r){e.onload=function(){t(e.result)},e.onerror=function(){r(e.error)}}))}function f(e){var t=new FileReader,r=m(t);return t.readAsArrayBuffer(e),r}function y(e){if(e.slice)return e.slice(0);var t=new Uint8Array(e.byteLength);return t.set(new Uint8Array(e)),t.buffer}function b(){return this.bodyUsed=!1,this._initBody=function(e){var t;this.bodyUsed=this.bodyUsed,this._bodyInit=e,e?"string"==typeof e?this._bodyText=e:n&&Blob.prototype.isPrototypeOf(e)?this._bodyBlob=e:s&&FormData.prototype.isPrototypeOf(e)?this._bodyFormData=e:r&&URLSearchParams.prototype.isPrototypeOf(e)?this._bodyText=e.toString():i&&n&&((t=e)&&DataView.prototype.isPrototypeOf(t))?(this._bodyArrayBuffer=y(e.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):i&&(ArrayBuffer.prototype.isPrototypeOf(e)||u(e))?this._bodyArrayBuffer=y(e):this._bodyText=e=Object.prototype.toString.call(e):(this._noBody=!0,this._bodyText=""),this.headers.get("content-type")||("string"==typeof e?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):r&&URLSearchParams.prototype.isPrototypeOf(e)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},n&&(this.blob=function(){var e=p(this);if(e)return e;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))}),this.arrayBuffer=function(){if(this._bodyArrayBuffer){var e=p(this);return e||(ArrayBuffer.isView(this._bodyArrayBuffer)?Promise.resolve(this._bodyArrayBuffer.buffer.slice(this._bodyArrayBuffer.byteOffset,this._bodyArrayBuffer.byteOffset+this._bodyArrayBuffer.byteLength)):Promise.resolve(this._bodyArrayBuffer))}if(n)return this.blob().then(f);throw new Error("could not read as ArrayBuffer")},this.text=function(){var e,t,r,o,n,s=p(this);if(s)return s;if(this._bodyBlob)return e=this._bodyBlob,t=new FileReader,r=m(t),o=/charset=([A-Za-z0-9_-]+)/.exec(e.type),n=o?o[1]:"utf-8",t.readAsText(e,n),r;if(this._bodyArrayBuffer)return Promise.resolve(function(e){for(var t=new Uint8Array(e),r=new Array(t.length),o=0;o<t.length;o++)r[o]=String.fromCharCode(t[o]);return r.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},s&&(this.formData=function(){return this.text().then(A)}),this.json=function(){return this.text().then(JSON.parse)},this}h.prototype.append=function(e,t){e=c(e),t=l(t);var r=this.map[e];this.map[e]=r?r+", "+t:t},h.prototype.delete=function(e){delete this.map[c(e)]},h.prototype.get=function(e){return e=c(e),this.has(e)?this.map[e]:null},h.prototype.has=function(e){return this.map.hasOwnProperty(c(e))},h.prototype.set=function(e,t){this.map[c(e)]=l(t)},h.prototype.forEach=function(e,t){for(var r in this.map)this.map.hasOwnProperty(r)&&e.call(t,this.map[r],r,this)},h.prototype.keys=function(){var e=[];return this.forEach((function(t,r){e.push(r)})),d(e)},h.prototype.values=function(){var e=[];return this.forEach((function(t){e.push(t)})),d(e)},h.prototype.entries=function(){var e=[];return this.forEach((function(t,r){e.push([r,t])})),d(e)},o&&(h.prototype[Symbol.iterator]=h.prototype.entries);var g=["CONNECT","DELETE","GET","HEAD","OPTIONS","PATCH","POST","PUT","TRACE"];function w(e,r){if(!(this instanceof w))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');var o,n,s=(r=r||{}).body;if(e instanceof w){if(e.bodyUsed)throw new TypeError("Already read");this.url=e.url,this.credentials=e.credentials,r.headers||(this.headers=new h(e.headers)),this.method=e.method,this.mode=e.mode,this.signal=e.signal,s||null==e._bodyInit||(s=e._bodyInit,e.bodyUsed=!0)}else this.url=String(e);if(this.credentials=r.credentials||this.credentials||"same-origin",!r.headers&&this.headers||(this.headers=new h(r.headers)),this.method=(o=r.method||this.method||"GET",n=o.toUpperCase(),g.indexOf(n)>-1?n:o),this.mode=r.mode||this.mode||null,this.signal=r.signal||this.signal||function(){if("AbortController"in t)return(new AbortController).signal}(),this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&s)throw new TypeError("Body not allowed for GET or HEAD requests");if(this._initBody(s),!("GET"!==this.method&&"HEAD"!==this.method||"no-store"!==r.cache&&"no-cache"!==r.cache)){var i=/([?&])_=[^&]*/;if(i.test(this.url))this.url=this.url.replace(i,"$1_="+(new Date).getTime());else{this.url+=(/\?/.test(this.url)?"&":"?")+"_="+(new Date).getTime()}}}function A(e){var t=new FormData;return e.trim().split("&").forEach((function(e){if(e){var r=e.split("="),o=r.shift().replace(/\+/g," "),n=r.join("=").replace(/\+/g," ");t.append(decodeURIComponent(o),decodeURIComponent(n))}})),t}function v(e,t){if(!(this instanceof v))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');if(t||(t={}),this.type="default",this.status=void 0===t.status?200:t.status,this.status<200||this.status>599)throw new RangeError("Failed to construct 'Response': The status provided (0) is outside the range [200, 599].");this.ok=this.status>=200&&this.status<300,this.statusText=void 0===t.statusText?"":""+t.statusText,this.headers=new h(t.headers),this.url=t.url||"",this._initBody(e)}w.prototype.clone=function(){return new w(this,{body:this._bodyInit})},b.call(w.prototype),b.call(v.prototype),v.prototype.clone=function(){return new v(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new h(this.headers),url:this.url})},v.error=function(){var e=new v(null,{status:200,statusText:""});return e.ok=!1,e.status=0,e.type="error",e};var _=[301,302,303,307,308];v.redirect=function(e,t){if(-1===_.indexOf(t))throw new RangeError("Invalid status code");return new v(null,{status:t,headers:{location:e}})};var C=t.DOMException;try{new C}catch(e){(C=function(e,t){this.message=e,this.name=t;var r=Error(e);this.stack=r.stack}).prototype=Object.create(Error.prototype),C.prototype.constructor=C}function P(e,r){return new Promise((function(o,s){var a=new w(e,r);if(a.signal&&a.signal.aborted)return s(new C("Aborted","AbortError"));var u=new XMLHttpRequest;function d(){u.abort()}if(u.onload=function(){var e,t,r={statusText:u.statusText,headers:(e=u.getAllResponseHeaders()||"",t=new h,e.replace(/\r?\n[\t ]+/g," ").split("\r").map((function(e){return 0===e.indexOf("\n")?e.substr(1,e.length):e})).forEach((function(e){var r=e.split(":"),o=r.shift().trim();if(o){var n=r.join(":").trim();try{t.append(o,n)}catch(e){console.warn("Response "+e.message)}}})),t)};0===a.url.indexOf("file://")&&(u.status<200||u.status>599)?r.status=200:r.status=u.status,r.url="responseURL"in u?u.responseURL:r.headers.get("X-Request-URL");var n="response"in u?u.response:u.responseText;setTimeout((function(){o(new v(n,r))}),0)},u.onerror=function(){setTimeout((function(){s(new TypeError("Network request failed"))}),0)},u.ontimeout=function(){setTimeout((function(){s(new TypeError("Network request timed out"))}),0)},u.onabort=function(){setTimeout((function(){s(new C("Aborted","AbortError"))}),0)},u.open(a.method,function(e){try{return""===e&&t.location.href?t.location.href:e}catch(t){return e}}(a.url),!0),"include"===a.credentials?u.withCredentials=!0:"omit"===a.credentials&&(u.withCredentials=!1),"responseType"in u&&(n?u.responseType="blob":i&&(u.responseType="arraybuffer")),r&&"object"==typeof r.headers&&!(r.headers instanceof h||t.Headers&&r.headers instanceof t.Headers)){var p=[];Object.getOwnPropertyNames(r.headers).forEach((function(e){p.push(c(e)),u.setRequestHeader(e,l(r.headers[e]))})),a.headers.forEach((function(e,t){-1===p.indexOf(t)&&u.setRequestHeader(t,e)}))}else a.headers.forEach((function(e,t){u.setRequestHeader(t,e)}));a.signal&&(a.signal.addEventListener("abort",d),u.onreadystatechange=function(){4===u.readyState&&a.signal.removeEventListener("abort",d)}),u.send(void 0===a._bodyInit?null:a._bodyInit)}))}async function O(e){if(e.status>=200&&e.status<400)return e;if(e.status>=400&&e.status<500){const t=await e.json(),r=new Error(t.error_message);return r.response=e,r.details=t,r.authIssue=!0,Promise.reject(r)}const t=new Error(e.statusText);return t.response=e,Promise.reject(t)}P.polyfill=!0,t.fetch||(t.fetch=P,t.Headers=h,t.Request=w,t.Response=v),self.fetch.bind(self);class S{constructor(e={}){const{name:t,method:r,headers:o,url:n,skipName:s,authenticated:i,apiUrl:a}=e;this.authenticated=i||!1,this.skipName=s||!1,this.name=t||"ApiBase",this.method=r||"POST",this.headers=o||{"content-type":"application/json"},this.apiUrl=a||null!=a?a:"https://app.xenonview.com",this.path_=n||""}params(e){return{}}path(e){return this.path_}fetch({data:e}={}){let t={};try{t=this.params(e)}catch(e){return Promise.reject(e)}let r={method:this.method,headers:this.headers};if(Object.keys(t).length||!this.skipName){let e={parameters:t};this.skipName||(e.name=this.name);const o=JSON.stringify(e);r.body=o}if(this.authenticated){const{token:t}=e;if(!t)return Promise.reject(new Error("No token and authenticated!"));r.accessToken=t}return function(e,{accessToken:t,headers:r,...o}={}){return o={credentials:"same-origin",keepalive:!0,headers:{accept:"application/json",...t?{authorization:`Bearer ${t}`}:{},...r},...o},fetch(e,o).then(O).then((e=>[204,304].includes(e.status)?{}:e.json())).catch((e=>{if(e instanceof TypeError){const e=new Error("Your internet connection appears to have gone down.");return e.noNet=!0,Promise.reject(e)}return Promise.reject(e)}))}(`${this.apiUrl}/${this.path(e)}`,r)}}class j extends S{constructor(e){super({name:"ApiJourney",url:"journey",apiUrl:e,authenticated:!0})}params(e){let t=function(e){const{journey:t}=e;return t?{journey:t}:{}}(e);const{id:r,timestamp:o}=e;return t.uuid=r,t.timestamp=o,t}}function T(e){return new j(e)}class U extends S{constructor(e){super({name:"ApiHeartbeat",url:"heartbeat",apiUrl:e,authenticated:!0})}params(e){let t=function(e){const{journey:t}=e;return t?{journey:t}:{}}(e);const{id:r,tags:o,platform:n,timestamp:s,watchdog:i}=e;return t.uuid=r,t.timestamp=s,t.tags=o,t.platform=n,i&&(t.watchdog=i),t}}function E(e){return new U(e)}class x extends S{constructor(e){super({name:"ApiDeanonymize",url:"deanonymize",apiUrl:e,authenticated:!0})}params(e){const{id:t,person:r,timestamp:o}=e;if(!r)throw new Error("No person data received.");let n={};return n.uuid=t,n.person=r,n.timestamp=o,n}}function D(e){return new x(e)}class I extends S{constructor(e){super({name:"ApiSample",url:"sample",apiUrl:e,authenticated:!0})}params(e){const{id:t}=e;let r={};return r.uuid=t,r}}function B(e){return new I(e)}class R extends S{constructor(e){super({name:"ApiIncrementCount",url:"increment_count",apiUrl:e,authenticated:!0})}params(e){const{uid:t,timestamp:r,outcome:o,content:n,value:s}=e,{leadSource:i,leadCampaign:a,leadGuid:u}=n;let c={};return c.uid=t,c.timestamp=r,c.outcome=o,c.leadSource=i,c.leadCampaign=a,c.leadGuid=u,c.value=s,c}}function k(e){return new R(e)}class F extends S{constructor(e){super({name:"ApiErrorLog",url:"error_log",apiUrl:e,authenticated:!0})}params(e){const{log:t}=e;let r={};return r.log=t,r}}function L(e){return new F(e)}const N={},J={setItem:(e,t)=>N[e]=t,getItem:e=>N[e],removeItem:e=>delete N[e]},H={},G={setItem:(e,t)=>H[e]=t,getItem:e=>H[e],removeItem:e=>delete H[e]};function q(){if("undefined"!=typeof window&&void 0!==window&&window&&window.localStorage)return window.localStorage;const t=e&&e.api?e.api:api;return void 0!==t&&void 0!==t&&t&&t&&void 0!==t.browser&&void 0!==t.browser&&t.browser&&t.browser.localStorage?t.browser.localStorage:G}function V(){if("undefined"!=typeof window&&void 0!==window&&window&&window.sessionStorage)return window.sessionStorage;const t=e&&e.api?e.api:api;return void 0!==t&&void 0!==t&&t&&t&&void 0!==t.browser&&void 0!==t.browser&&t.browser&&t.browser.sessionStorage?t.browser.sessionStorage:J}function K(e,t){q().setItem(e,JSON.stringify(t))}function M(e){const t=q().getItem(e);return t?JSON.parse(t):null}function z(e){q().removeItem(e)}function $(e,t){V().setItem(e,JSON.stringify(t))}function X(e){const t=V().getItem(e);return t?JSON.parse(t):null}function Y(e){V().removeItem(e)}const W=new class{constructor(e=null,t="https://app.xenonview.com",r="https://counts.xenonlab.ai",o=T,n=D,s=E,i=B,a=k,u=L){this.JourneyApi=o,this.DeanonApi=n,this.HeartbeatApi=s,this.SampleApi=i,this.CountApi=a,this.ErrorLogApi=u,this.pageURL_=null,this.id(),this.journey()||this.storeJourney([]),this.restoreJourney=[],this.apiCallPending=!1,this.apiUrl=t,this.countApiUrl=r,e&&this.init(e,t)}version(){return"v0.1.40.0"}init(e,t="https://app.xenonview.com",r=null){this.apiUrl=t,this.apiKey=e,this.sampleDecision(null,r),this.apiCallPending=!1}ecomAbandonment(){K("heartbeat_type","ecom"),this.heartbeatState(0)}customAbandonment(e){K("heartbeat_type","custom"),K("heartbeat_outcome",e),this.heartbeatState(0)}cancelAbandonment(){K("heartbeat_type","custom"),K("heartbeat_outcome",{remove:!0}),this.heartbeatState(0)}platform(e,t,r,o){$("view-platform",{softwareVersion:e,deviceModel:t,operatingSystemName:r,operatingSystemVersion:o})}removePlatform(){Y("view-platform")}variant(e){$("view-tags",e)}resetVariants(){Y("view-tags")}startVariant(e){let t=X("view-tags");t&&t.includes(e)||(this.resetVariants(),this.variant([e]))}addVariant(e){let t=X("view-tags");t&&t.includes(e)||(t?t.push(e):t=[e],this.variant(t))}leadAttributed(e,t=null){this.count("Attribution")}leadUnattributed(){this.count("Attribution")}leadCaptured(e){const t={superOutcome:"Lead Capture",outcome:e,result:"success"};this.outcomeAdd(t)}leadCaptureDeclined(e){const t={superOutcome:"Lead Capture",outcome:e,result:"fail"};this.outcomeAdd(t)}accountSignup(e){const t={superOutcome:"Account Signup",outcome:e,result:"success"};this.outcomeAdd(t)}accountSignupDeclined(e){const t={superOutcome:"Account Signup",outcome:e,result:"fail"};this.outcomeAdd(t)}applicationInstalled(){this.outcomeAdd({superOutcome:"Application Installation",outcome:"Installed",result:"success"})}applicationNotInstalled(){this.outcomeAdd({superOutcome:"Application Installation",outcome:"Not Installed",result:"fail"})}initialSubscription(e,t=null,r=null,o=null){const n={superOutcome:"Initial Subscription",outcome:"Subscribe - "+e,result:"success"};t&&(n.method=t),r&&(n.price=r),o&&(n.term=o),this.outcomeAdd(n)}subscriptionDeclined(e,t=null,r=null,o=null){const n={superOutcome:"Initial Subscription",outcome:"Decline - "+e,result:"fail"};t&&(n.method=t),r&&(n.price=r),o&&(n.term=o),this.outcomeAdd(n)}subscriptionRenewed(e,t=null,r=null,o=null){const n={superOutcome:"Subscription Renewal",outcome:"Renew - "+e,result:"success"};t&&(n.method=t),r&&(n.price=r),o&&(n.term=o),this.outcomeAdd(n)}subscriptionPaused(e,t=null,r=null,o=null){const n={superOutcome:"Subscription Renewal",outcome:"Paused - "+e,result:"fail"};t&&(n.method=t),r&&(n.price=r),o&&(n.term=o),this.outcomeAdd(n)}subscriptionCanceled(e,t=null,r=null,o=null){const n={superOutcome:"Subscription Renewal",outcome:"Cancel - "+e,result:"fail"};t&&(n.method=t),r&&(n.price=r),o&&(n.term=o),this.outcomeAdd(n)}subscriptionUpsold(e,t=null,r=null,o=null){const n={superOutcome:"Subscription Upsold",outcome:"Upsold - "+e,result:"success"};t&&(n.method=t),r&&(n.price=r),o&&(n.term=o),this.outcomeAdd(n)}subscriptionUpsellDeclined(e,t=null,r=null,o=null){const n={superOutcome:"Subscription Upsold",outcome:"Declined - "+e,result:"fail"};t&&(n.method=t),r&&(n.price=r),o&&(n.term=o),this.outcomeAdd(n)}subscriptionDownsell(e,t=null,r=null,o=null){const n={superOutcome:"Subscription Upsold",outcome:"Downsell - "+e,result:"fail"};t&&(n.method=t),r&&(n.price=r),o&&(n.term=o),this.outcomeAdd(n)}adClicked(e,t=null,r=null){const o={superOutcome:"Advertisement",outcome:"Ad Click - "+e,result:"success"};t&&(o.id=t),r&&(o.price=r),this.outcomeAdd(o)}adIgnored(e,t=null,r=null){const o={superOutcome:"Advertisement",outcome:"Ad Ignored - "+e,result:"fail"};t&&(o.id=t),r&&(o.price=r),this.outcomeAdd(o)}referral(e,t=null){const r={superOutcome:"Referral",outcome:"Referred - "+e,result:"success"};t&&(r.details=t),this.outcomeAdd(r)}referralDeclined(e,t=null){const r={superOutcome:"Referral",outcome:"Declined - "+e,result:"fail"};t&&(r.details=t),this.outcomeAdd(r)}productAddedToCart(e,t=null){const r={superOutcome:"Add Product To Cart",outcome:"Add - "+e,result:"success"};t?r.price=t:t=0,this.outcomeAdd(r),this.heartbeatState(1),this.count("Add To Cart",t)}productNotAddedToCart(e){const t={superOutcome:"Add Product To Cart",outcome:"Ignore - "+e,result:"fail"};this.outcomeAdd(t)}upsold(e,t=null){const r={superOutcome:"Upsold Product",outcome:"Upsold - "+e,result:"success"};t?r.price=t:t=0,this.outcomeAdd(r),this.count("Upsell",t)}upsellDismissed(e,t=null){const r={superOutcome:"Upsold Product",outcome:"Dismissed - "+e,result:"fail"};t&&(r.price=t),this.outcomeAdd(r)}checkOut(e=null){let t="Check Out",r="Check Out";null!=e&&(t="Check Out - "+e,r="Checkout:"+e);const o={superOutcome:"Customer Checkout",outcome:t,result:"success"};this.outcomeAdd(o),this.heartbeatState(2),this.count(r)}checkoutCanceled(){this.outcomeAdd({superOutcome:"Customer Checkout",outcome:"Canceled",result:"fail"})}productRemoved(e){const t={superOutcome:"Customer Checkout",outcome:"Product Removed - "+e,result:"fail"};this.outcomeAdd(t)}purchase(e,t=null,r=null,o=null,n=null){let s="Purchase",i="Purchase";null!=n&&(s="Purchase - "+n,i="Purchase:"+n);const a={superOutcome:"Customer Purchase",outcome:s,skus:e,result:"success"};t?a.price=t:t=0,r&&(a.discount=r),o&&(a.shipping=o),this.outcomeAdd(a),this.heartbeatState(3),this.count(i,t)}purchaseCancel(e=null,t=null){const r={superOutcome:"Customer Purchase",outcome:"Canceled"+(e?" - "+e:""),result:"fail"};t&&(r.price=t),this.outcomeAdd(r)}promiseFulfilled(){this.outcomeAdd({superOutcome:"Promise Fulfillment",outcome:"Fulfilled",result:"success"})}promiseUnfulfilled(){this.outcomeAdd({superOutcome:"Promise Fulfillment",outcome:"Unfulfilled",result:"fail"})}productKept(e){const t={superOutcome:"Product Disposition",outcome:"Kept - "+e,result:"success"};this.outcomeAdd(t)}productReturned(e){const t={superOutcome:"Product Disposition",outcome:"Returned - "+e,result:"fail"};this.outcomeAdd(t)}featureAttempted(e,t=null){const r={category:"Feature",action:"Attempted",name:e};t&&(r.details=t),this.journeyAdd(r)}featureCompleted(e,t=null){const r={category:"Feature",action:"Completed",name:e};t&&(r.details=t),this.journeyAdd(r)}featureFailed(e,t=null){const r={category:"Feature",action:"Failed",name:e};t&&(r.details=t),this.journeyAdd(r)}contentViewed(e,t=null){const r={category:"Content",action:"Viewed",type:e};t&&(r.identifier=t),this.journeyAdd(r)}contentEdited(e,t=null,r=null){const o={category:"Content",action:"Edited",type:e};t&&(o.identifier=t),r&&(o.details=r),this.journeyAdd(o)}contentCreated(e,t=null){const r={category:"Content",action:"Created",type:e};t&&(r.identifier=t),this.journeyAdd(r)}contentDeleted(e,t=null){const r={category:"Content",action:"Deleted",type:e};t&&(r.identifier=t),this.journeyAdd(r)}contentArchived(e,t=null){const r={category:"Content",action:"Archived",type:e};t&&(r.identifier=t),this.journeyAdd(r)}contentRequested(e,t=null){const r={category:"Content",action:"Requested",type:e};t&&(r.identifier=t),this.journeyAdd(r)}contentSearched(e){const t={category:"Content",action:"Searched",type:e};this.journeyAdd(t)}pageLoadTime(e,t){const r={category:"Webpage Load Time",time:e.toString(),identifier:t};this.journeyAdd(r)}milestone(e,t,r,o){const n={category:e,action:t,name:r,details:o};this.journeyAdd(n)}count(e,t=0,r=!1){const o=X("view-attribution");if(!o)return Promise.resolve(!0);const n=X("view-count-replay");if(n)for(const e in n)this.countInternal(e,r);let s={data:{uid:this.id(),token:this.apiKey,timestamp:(new Date).getTime()/1e3,outcome:e,content:o,value:t}};return this.countInternal(s,r)}countInternal(e,t){return this.CountApi(this.countApiUrl).fetch(e).catch((r=>{const o=X("view-count-replay");return o?(o.push(e),$("view-count-replay",o)):$("view-count-replay",[e]),t?Promise.reject(r):Promise.resolve(!0)}))}commit(e=!1){if(!this.sampleDecision()||this.apiCallPending)return Promise.resolve(!0);this.apiCallPending=!0;let t={data:{id:this.id(),journey:this.journey(),token:this.apiKey,timestamp:(new Date).getTime()/1e3}};const r=this.reset();return this.JourneyApi(this.apiUrl).fetch(t).then((e=>(this.apiCallPending=!1,Promise.resolve(e)))).catch((t=>(this.restore(r),this.apiCallPending=!1,this.apiCallPending=!1,e?Promise.reject(t):Promise.resolve(!0))))}heartbeatState(e=null){const t=M("heartbeat_stage");return e&&e>t&&K("heartbeat_stage",e),e||t||K("heartbeat_stage",0),Number(M("heartbeat_stage"))}heartbeatMessage(e){const t=this.heartbeatState(),r={ecom:{0:{expires_in_seconds:600,if_abandoned:{superOutcome:"Add Product To Cart",outcome:"Abandoned",result:"fail"}},1:{expires_in_seconds:600,if_abandoned:{superOutcome:"Customer Checkout",outcome:"Abandoned",result:"fail"}},2:{expires_in_seconds:600,if_abandoned:{superOutcome:"Customer Purchase",outcome:"Abandoned",result:"fail"}},3:{remove:!0}}};return Object.keys(r).includes(e)?r[e][t]:M("heartbeat_outcome")}heartbeat(e=!1){const t=X("view-platform"),r=X("view-tags");let o={data:{id:this.id(),journey:this.journey(),token:this.apiKey,platform:t||{},tags:r||[],timestamp:(new Date).getTime()/1e3}};const n=M("heartbeat_type");if(n&&(o.data.watchdog=this.heartbeatMessage(n)),!this.sampleDecision()||this.apiCallPending)return Promise.resolve(!0);this.apiCallPending=!0;const s=this.reset();return this.HeartbeatApi(this.apiUrl).fetch(o).then((e=>(n&&Object.keys(o.data.watchdog).includes("remove")&&(z("heartbeat_stage"),z("heartbeat_type"),z("heartbeat_outcome")),this.apiCallPending=!1,Promise.resolve(e)))).catch((t=>(this.restore(s),this.apiCallPending=!1,e?Promise.reject(t):Promise.resolve(!0))))}deanonymize(e){if(!this.sampleDecision())return Promise.resolve(!0);let t={data:{id:this.id(),person:e,token:this.apiKey,timestamp:(new Date).getTime()/1e3}};return this.DeanonApi(this.apiUrl).fetch(t)}recordError(e){if(!this.sampleDecision())return Promise.resolve(!0);let t={data:{log:e,token:this.apiKey}};return this.ErrorLogApi(this.apiUrl).fetch(t)}id(e){return e&&$("xenon-view",e),(e=X("xenon-view"))&&""!==e?e:this.newId()}newId(){return $("xenon-view",crypto.randomUUID()),X("xenon-view")}sampleDecision(e=null,t=null){if(null!==e&&$("xenon-will-sample",e),null===(e=X("xenon-will-sample"))||""===e){let r={data:{id:this.id(),token:this.apiKey}};this.SampleApi(this.apiUrl).fetch(r).then((r=>{e=this.sampleDecision(r.sample,t)})).catch((r=>{r.authIssue&&t?t(r):e=this.sampleDecision(!0,t)}))}return e=null!==e?Boolean(e):null}outcomeAdd(e){let t=X("view-platform");t&&(e.platform=t);let r=X("view-tags");r&&(e.tags=r),this.journeyAdd(e)}journeyAdd(e){let t=this.journey();if(e.timestamp=(new Date).getTime()/1e3,this.pageURL_&&(e.url=this.pageURL_),t&&t.length){let r=t[t.length-1];if(this.isDuplicate(r,e)){let e=r.hasOwnProperty("count")?r.count:1;r.count=e+1}else t.push(e)}else t=[e];this.storeJourney(t)}isDuplicate(e,t){const r=Object.keys(e),o=Object.keys(t);return!!((e,t)=>{for(const r of t)if(!e.has(r))return!1;return!0})(new Set(r),new Set(o))&&(!(!o.includes("category")||!r.includes("category"))&&(t.category===e.category&&(!(!o.includes("action")||!r.includes("action"))&&(t.action===e.action&&(this.duplicateFeature(e,t,r,o)||this.duplicateContent(e,t,r,o)||this.duplicateMilestone(e,t,r,o))))))}duplicateFeature(e,t,r,o){return"Feature"===t.category&&"Feature"===e.category&&t.name===e.name}duplicateContent(e,t,r,o){return"Content"===t.category&&"Content"===e.category&&(!o.includes("type")&&!r.includes("type")||t.type===e.type&&(!o.includes("identifier")&&!r.includes("identifier")||t.identifier===e.identifier&&(!o.includes("details")&&!r.includes("details")||t.details===e.details)))}duplicateMilestone(e,t,r,o){return"Feature"!==t.category&&"Feature"!==e.category&&("Content"!==t.category&&"Content"!==e.category&&(t.name===e.name&&t.details===e.details))}journey(){return M("view-journey")}storeJourney(e){K("view-journey",e)}reset(){return this.restoreJourney=this.journey(),z("view-journey"),this.storeJourney([]),this.restoreJourney}restore(e=null){let t=this.journey(),r=e||this.restoreJourney;null!==t&&t.length&&(r=r.concat(t)),r.sort((function(e,t){return e.timestamp<t.timestamp?-1:e.timestamp>t.timestamp?1:0})),this.storeJourney(r),this.restoreJourney=[]}hasClassInHierarchy(e,t,r){const o=(e,t,r,n)=>!(n>=r)&&(!!e.className.toString().includes(t)||!!e.parentElement&&o(e.parentElement,t,r,n+1));return o(e,t,r,0)}decipherParamsPerLibrary(e){if(e.has("xenonSrc"))return[e.get("xenonSrc"),e.get("xenonId")];if(e.has("cr_campaignid"))return["Cerebro",e.get("cr_campaignid")];if(e.has("utm_source")&&"klaviyo"===e.get("utm_source").toLowerCase()){return["Klaviyo"+(e.has("utm_medium")?" - "+e.get("utm_medium"):""),e.get("utm_campaign")]}return e.has("g_campaignid")?["Google Ad",e.get("g_campaignid")]:e.has("utm_source")&&"shareasale"===e.get("utm_source").toLowerCase()||e.has("sscid")?["Share-a-sale",e.get("sscid")]:e.has("g_adtype")&&"none"===e.get("g_adtype")?["Google Organic",e.get("g_campaign")]:e.has("g_adtype")&&"search"===e.get("g_adtype")?["Google Paid Search",e.get("g_campaign")]:e.has("utm_source")&&"facebook"===e.get("utm_source")?["Facebook Ad",e.get("utm_campaign")]:e.has("utm_source")&&"email-broadcast"===e.get("utm_source").toLowerCase()?["Email",e.get("utm_campaign")]:e.has("utm_source")&&"youtube"===e.get("utm_source").toLowerCase()?["YouTube",e.get("utm_campaign")]:e.has("utm_source")?[e.get("utm_source"),e.get("utm_campaign")]:["Unattributed"]}autodiscoverLeadFrom(e){if(e&&""!==e&&"?"!==e){const t=new URLSearchParams(e),[r,o]=this.decipherParamsPerLibrary(t);if(X("view-attribution"))return e;$("view-attribution",{leadSource:r,leadCampaign:o,leadGuid:null});let n=X("view-tags");!r||n&&n.includes(r)||(n?(n.push(r),o&&n.push(o)):(n=[r],o&&n.push(o)),this.variant(n),"Unattributed"===r?this.leadUnattributed():this.leadAttributed(r,o)),t.delete("xenonId"),t.delete("xenonSrc");let s="";return t.size&&(s="?"+t.toString()),s}{let t=X("view-tags");const r="Unattributed";return X("view-attribution")||($("view-attribution",{leadSource:r,leadCampaign:null,leadGuid:null}),t&&t.includes(r)||(t?t.push(r):t=[r],this.variant(t),this.leadUnattributed())),e}}pageURL(e){this.pageURL_=e}};return W}();
